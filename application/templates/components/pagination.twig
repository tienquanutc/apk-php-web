{% import _self as __self %}
{% macro p_item(pagination, page) %}
  {% if page != 1 %}
    <a href="{{ pagination.path }}?page={{ page }}{% if pagination.paging_query %}&{{ pagination.paging_query }}{% endif %}" class="abutton{{ page == pagination.current_page_index ? ' is-link' : '' }}">{{ page }}</a>
  {%else%}
    <a href="{{ pagination.path }}{% if pagination.paging_query %}?{{ pagination.paging_query }}{% endif %}" class="abutton{{ page == pagination.current_page_index ? ' is-link' : '' }}">{{ page }}</a>
  {% endif %}
{% endmacro p_item %}

{% set adjacents = 1%}
{% if pagination.total_pages is not null and pagination.total_pages > 1%}
  <div class="abuttons" style="display: block; text-align: center;">
    {#prev#}
    {% if pagination.current_page_index > 1 %}
      {% if pagination.current_page_index != 2 %}
        <a href="{{ pagination.path }}?page={{ pagination.current_page_index - 1 }}{% if paging_query %}&{{ pagination.paging_query }}{% endif %}" class="abutton" rel="prev">❮</a>
      {% else %}
        <a href="{{ pagination.path }}{% if paging_query %}?{{ pagination.paging_query }}{% endif %}" class="abutton" rel="prev">❮</a>
      {% endif %}
    {% else %}
      <a class="abutton" disabled>❮</a>
    {%endif%}

    {#page#}
    {% if pagination.total_pages < 5 + (adjacents)  * 2 %}  {# not enough pages to bother breaking it up#}
      {% for counter in range(1, pagination.total_pages) %} {{ __self.p_item(pagination, counter) }}{% endfor %}
    {%else%} {# enough pages to hide some #}
      {#close to beginning; only hide later pages#}
      {% if pagination.current_page_index < 1 + (adjacents * 2)%}
        {% for counter in range(1, 4 + (adjacents *2) - 1) %} {{ __self.p_item(pagination, counter) }}{% endfor %}
        <span class="pagination-ellipsis">&hellip;</span>
        {{ __self.p_item(pagination, pagination.total_pages) }}
      {%elseif pagination.has_more_page == true or (pagination.total_pages - (adjacents * 2) > pagination.current_page_index) and (pagination.current_page_index > (adjacents * 2))%}
        {{ __self.p_item(pagination, 1) }}
        <span class="pagination-ellipsis">&hellip;</span>
        {% for counter in range(pagination.current_page_index - adjacents, pagination.current_page_index + adjacents) %}{{ __self.p_item(pagination, counter) }}{% endfor %}

        <span class="pagination-ellipsis">&hellip;</span>
        {{ __self.p_item(pagination, pagination.total_pages) }}
      {%else%}
        {{ __self.p_item(pagination, 1) }}
        <span class="pagination-ellipsis">&hellip;</span>
        {% for counter in range(pagination.total_pages - (2 + (adjacents * 2)), pagination.total_pages) %} {{ __self.p_item(pagination, counter) }}{% endfor %}
      {% endif %}
    {% endif %}

    {#next#}
    {% if pagination.has_more_page == true or pagination.current_page_index < pagination.total_pages %}
      <a href="{{ pagination.path }}?page={{ pagination.current_page_index + 1 }}{% if paging_query %}&{{ pagination.paging_query }}{% endif %}" class="abutton" rel="next">❯</a>
    {% else %}
      <a class="abutton" disabled>❯</a>
    {%endif%}
  </div>

{% endif %}
